<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>
			ES7 Decorator 装饰者模式 浅出 -

			苏思洋的博客 </title>

		<meta name="author" content="susu">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- HTML5 shim, for IE6-8 support of HTML elements -->
		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link href="/assets/style.min.css?body=3.3.1" rel="stylesheet" type="text/css" media="all">
		<link rel="alternate" type="application/rss+xml" title="RSS 2.0 - 所有文章" href="feed.xml" />
		<link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
		<!-- fav and touch icons -->
		<!-- Update these with your own images
		<link rel="shortcut icon" href="images/favicon.ico">
		<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
		<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
		-->
	</head>

	<body>
		<div class="navbar">
			<img id="profile" src="/blog-assets/susu.jpg" alt="susu" class="rollIn animated">
			<ul class="nav">













		<li id="label1" class="labels"><a href="/">

				最新文章

		</a></li>








		<li id="label2" class="labels"><a href="/other">

				杂谈

		</a></li>









				<li id="label3" class="active labels"><a href="/qianduan" class="active">前端技术</a></li>














		<li id="label4" class="labels"><a href="/tec_css">

				交互设计

		</a></li>








		<li id="label5" class="labels"><a href="/view_des">

				视觉设计

		</a></li>








			</ul>
			<div class="f_like">
			<div>友链</div>
			<ul class="links">

                 <li class="link"><a href="http://hyq.me" title="hyq">hyq</a></li>

                 <li class="link"><a href="http://catalystdp.github.io/" title="catalystdp">catalystdp</a></li>

			</ul>
			</div>
		</div>
		<div id="sidebar">
			<div id="title_wrap" class=" title3">
				<h2 class="title">










							前端技术








				</h2>
			</div>


					<ul class="posts">








      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/12/01/web_build"><span class="circle_icon"></span>前端工程化技能树整理<span class='date'>01 Dec 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/11/30/es6_Design-pattern"><span class="circle_icon"></span>ES6 实现几种 设计模式<span class='date'>30 Nov 2015</span></a></li>







      	<li class="active"><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/11/23/es7_decorator" class="active"><span class="circle_icon"></span>ES7 Decorator 装饰者模式 浅出<span class='date'>23 Nov 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/11/10/requestAnimationFrame"><span class="circle_icon"></span>requestAnimationFrame 详解<span class='date'>10 Nov 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/05/14/css_BFC"><span class="circle_icon"></span>BFC 神奇背后的原理<span class='date'>14 May 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/05/12/js-opt"><span class="circle_icon"></span>前端性能优化实践<span class='date'>12 May 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/04/29/learn-web"><span class="circle_icon"></span>2015年值得关注的几个WEB技术<span class='date'>29 Apr 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/04/10/HTTP_API"><span class="circle_icon"></span>HTTP API 设计指南<span class='date'>10 Apr 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/04/09/html_guid"><span class="circle_icon"></span>HTML编码规范<span class='date'>09 Apr 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/03/31/less_guide"><span class="circle_icon"></span>Less规范<span class='date'>31 Mar 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/03/31/javascript_guide"><span class="circle_icon"></span>JavaScript规范<span class='date'>31 Mar 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/03/31/css_guide"><span class="circle_icon"></span>CSS规范<span class='date'>31 Mar 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/03/16/javascript_tip"><span class="circle_icon"></span>前端小技巧总结<span class='date'>16 Mar 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/03/13/pm2"><span class="circle_icon"></span>用pm2管理node进程<span class='date'>13 Mar 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2015/03/13/pm2-web"><span class="circle_icon"></span>pm2-web监控node.js应用服务状态<span class='date'>13 Mar 2015</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2014/08/13/nodejs_update"><span class="circle_icon"></span>node.js升级<span class='date'>13 Aug 2014</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2014/04/11/Canvas_API"><span class="circle_icon"></span>Canvas API<span class='date'>11 Apr 2014</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2014/01/21/html-zhuanyi"><span class="circle_icon"></span>JavaScript 的HTML转义方法<span class='date'>21 Jan 2014</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2014/01/09/IE-iframe-P3P"><span class="circle_icon"></span>IE下iframe跨域session丢失问题和解决<span class='date'>09 Jan 2014</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/11/26/cross-domian"><span class="circle_icon"></span>JavaScript 跨域访问的问题和解决过程<span class='date'>26 Nov 2013</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/11/07/javascript-tip"><span class="circle_icon"></span>javascript 小技巧<span class='date'>07 Nov 2013</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/25/31CSS"><span class="circle_icon"></span>31 种 CSS 选择器用法<span class='date'>25 Oct 2013</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/05/Responsive_Web_Design_step"><span class="circle_icon"></span>复杂产品的响应式设计【流程篇】<span class='date'>05 Oct 2013</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/05/Responsive_Web_Design"><span class="circle_icon"></span>响应式网页设计<span class='date'>05 Oct 2013</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/03/qianduan"><span class="circle_icon"></span>前端的困局与突围(from 玉伯)<span class='date'>03 Oct 2013</span></a></li>







      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/03/markdown"><span class="circle_icon"></span>如何使用markdown<span class='date'>03 Oct 2013</span></a></li>







					</ul>











		</div>
		<div id="container">
			<button class="navbar-toggle" type="button">
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
      		</button>
			<div id="pjax">
				<article id="post" class="title3">
					<header id="header">
						<h1 id="identifier">
								ES7 Decorator 装饰者模式 浅出
						</h1>
					</header>
					<div id="content">
						<h2 id="es6-已经来了es7-还会远么">ES6 已经来了，ES7 还会远么？</h2>

<p>ES6 标准正式发布，众多新特性成为标准固然另人激动，然而更值得憧憬的还是未来。所以，让我们来看看 ES7（更正式的说法是 ES2016）有哪些激动人心的变化。最为人津津乐道的可能就是 async/await 了，不过我个人出对 decorator 模式有点感兴趣，本文尝试对此做一个介绍。</p>

<h3 id="decorator-是什么">decorator 是什么</h3>

<p>ES7 的 decorator 概念是从 Python 借来的，在 Python 里，decorator 实际上是一个 wrapper，它作用于一个目标函数，对这个目标函数做一些额外的操作，然后返回一个新的函数：</p>

<pre><code class="language-python">def my_decorator(fn):
  def inner(name):
    print 'Hello ' + fn(name)
  return inner

@my_decorator
def greet(name):
  return name

greet('Decorator!')
</code></pre>

<p>这种 @decorator 的写法其实是一种语法糖，从 <code>my_decorator</code>的定义就可以看出，它接收一个函数（ fn ）为参数，定义一个新的内部函数（ innner ），这个内部函数会定义一些行为，最后 <code>my_decorator</code> 返回这个内部函数（ inner ）。</p>

<p>上面的 <code>@my_decorator</code>等于：</p>

<pre><code class="language-js">greet = my_decorator(greet)

greet('Decorator!')

</code></pre>

<h2 id="hello-decorator">Hello Decorator!</h2>

<p>ES7 中的 decorator 同样借鉴了这个语法糖，不过依赖于 ES5 的 Object.defineProperty 方法 。</p>

<h2 id="浅出">浅出</h2>

<p>想必大家都该玩过LOL吧。那么我就以英雄联盟英雄为例子。</p>

<p>##第一步：</p>

<ul>
  <li>英雄</li>
</ul>

<pre><code class="language-js">class Hero{
  constructor(def = 30,atk = 70,hp = 630){
    this.init({def,atk,hp});
  }
  init({def,atk,hp}){
    this.hp=hp;
    this.attcak=atk;
    this.defence=def;
  }
}
</code></pre>

<ul>
  <li>德玛西亚 ps：这只是个小德玛，简单的继承了英雄属性而已，没特色啊，防御和血量哪去了。。</li>
</ul>

<pre><code class="language-js">class 德玛西亚 extends Hero{
  init(args){
    super.init(args);
  }
  toString(){
    return `防御力:${this.defence},攻击力:${this.attcak},血量:${this.hp}`;
  }
}
var _德玛西亚 = new 德玛西亚();

console.log(`当前状态 ===&gt; ${_德玛西亚}`);
// 当前状态 ===&gt; 防御力:30,攻击力:70,血量:630
</code></pre>

<p>##第二步</p>

<ul>
  <li>初始化德玛属性</li>
</ul>

<pre><code class="language-js">function 德玛西亚初始(target, key, descriptor) {
  const method = descriptor.value;
  let moreHP = 150;
  let ret;
  descriptor.value = ({def,atk,hp})=&gt;{
    hp+=moreHP;
    ret = target::method({def,atk,hp});
    return ret;
  }
  return descriptor;
}

class 德玛西亚 extends Hero{
  @德玛西亚初始;
  init(args){
    super.init(args);
  }
  toString(){
    return `防御力:${this.defence},攻击力:${this.attcak},血量:${this.hp}`;
  }
}
var _德玛西亚 = new 德玛西亚();

console.log(`当前状态 ===&gt; ${_德玛西亚}`);
// 当前状态 ===&gt; 防御力:30,攻击力:70,血量:780
</code></pre>
<p>血量变多了。还好吧，那下一步给他个被动技能吧！</p>

<p>####这里可能会有两个疑问：</p>

<ol>
  <li><code>德玛西亚初始</code>方法的参数为啥是这三个？可以更换么？</li>
  <li><code>德玛西亚初始</code>方法为什么返回的是descriptor</li>
</ol>

<p>####这里给出的解答作为参考：</p>

<blockquote>
  <table>
    <tbody>
      <tr>
        <td>Decorators 的本质是利用了ES5的 Object.defineProperty 属性，这三个参数其实是和 Object.defineProperty参数一致的，因此不能更改。可以看看 bable转换后 的代码，其中有一句是descriptor = decorator(target, key, descriptor)</td>
        <td> </td>
        <td>descriptor;，点到为止，这里不详细展开了，可自行看看这行代码的上下文</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<ul>
  <li>初始化德玛西亚的被动技能</li>
</ul>

<pre><code class="language-js">

function 德玛被动() {
  return function(target){
    let extra = '(技能加成:盖伦在7秒内不受到任何伤害之后，每秒回复最大生命值的0.5% )';
    let method = target.prototype.toString;
    target.prototype.toString = (...args)=&gt;{
      return target.prototype::method(args) + extra;
    }
    return target;
  }
}

@德玛被动()
class 德玛西亚 extends Hero{
  @德玛西亚初始;
  init(args){
    super.init(args);
  }
  toString(){
    return `防御力:${this.defence},攻击力:${this.attcak},血量:${this.hp}`;
  }
}
var _德玛西亚 = new 德玛西亚();

console.log(`当前状态 ===&gt; ${_德玛西亚}`);
// 当前状态 ===&gt; 防御力:30,攻击力:70,血量:780(技能加成:盖伦在7秒内不受到任何伤害之后，每秒回复最大生命值的0.5% )

</code></pre>

<p>好啦完整的德玛西亚出来了。</p>

<blockquote>
  <p>代码直接放在 <a href="">http://babeljs.io/repl/</a> 中运行查看结果，记得勾选Experimental选项和Evaluate选项</p>
</blockquote>


					</div>
				</article>
			</div>
			<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread">

<div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare">
<a class="bds_tsina"></a>
<a class="bds_tqq"></a>
<a class="bds_renren"></a>
<a class="bds_hi"></a>
<span class="bds_more">更多</span>
</div>
<script type="text/javascript" id="bdshare_js" data="type=tools&amp;mini=1&amp;uid=6840238" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
</script>
	</div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"susiyang"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->

		</div>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.2.min.js"></script>
<script src="/assets/index.min.js?body=4.0.0"></script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ffbcbbadeaf00526725e0f222ba832804' type='text/javascript'%3E%3C/script%3E"));
</script>
	</body>
</html>
