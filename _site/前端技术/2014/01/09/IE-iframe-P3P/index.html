<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title> 
			IE下iframe跨域session丢失问题和解决 -
			
			苏思洋的博客 </title>
		
		<meta name="author" content="susu">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- HTML5 shim, for IE6-8 support of HTML elements -->
		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link href="/assets/style.min.css?body=3.3.1" rel="stylesheet" type="text/css" media="all">
		<link rel="alternate" type="application/rss+xml" title="RSS 2.0 - 所有文章" href="feed.xml" />
		<link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
		<!-- fav and touch icons -->
		<!-- Update these with your own images
		<link rel="shortcut icon" href="images/favicon.ico">
		<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
		<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
		-->
	</head>

	<body>
		<div class="navbar">
			<img id="profile" src="/blog-assets/susu.jpg" alt="susu" class="rollIn animated">
			<ul class="nav">
				
				
				 
 
    
      
    
  
    
  
    
      
      	
		<li id="label1" class="labels"><a href="/index.html">
			
				最新文章
			
		</a></li>
	
      	
      
    
  
    
      
      	
		<li id="label2" class="labels"><a href="/other.html">
			
				杂谈
			
		</a></li>
	
      	
      
    
  
    
      
      	
				
				<li id="label3" class="active labels"><a href="/qianduan.html" class="active">前端技术</a></li>
				
		
		
		
      
    
  
    
      
    
  
    
      
      	
		<li id="label4" class="labels"><a href="/tec_css.html">
			
				交互设计
			
		</a></li>
	
      	
      
    
  
    
      
      	
		<li id="label5" class="labels"><a href="/view_des.html">
			
				视觉设计
			
		</a></li>
	
      	
      
    
  



			</ul>
			<div class="f_like">
			<div>友链</div>
			<ul class="links">
				
                 <li class="link"><a href="http://hyq.me" title="hyq">hyq</a></li>
                                                
                 <li class="link"><a href="http://www.tetequ.com" title="特特区-音视频在线工具">特特区-音视频在线工具</a></li>
                                                
                 <li class="link"><a href="http://www.dlmu.net" title="启航计算机协会">启航计算机协会</a></li>
                                                
			</ul>
			</div>
		</div>
		<div id="sidebar">
			<div id="title_wrap" class=" title3">
				<h2 class="title">
					
						
					
						
					
						
					
						
					
						
							前端技术
						
					
						
					
						
					
						
					
				</h2>
			</div>
				
					
					<ul class="posts">
						
						


  
    
      
      	
      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2014/01/21/html-zhuanyi"><span class="circle_icon"></span>JavaScript 的HTML转义方法<span class='date'>21 Jan 2014</span></a></li>
      	
      
    
  
    
      
      	
      	<li class="active"><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2014/01/09/IE-iframe-P3P" class="active"><span class="circle_icon"></span>IE下iframe跨域session丢失问题和解决<span class='date'>09 Jan 2014</span></a></li>
      	
      
    
  
    
      
      	
      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/11/26/cross-domian"><span class="circle_icon"></span>JavaScript 跨域访问的问题和解决过程<span class='date'>26 Nov 2013</span></a></li>
      	
      
    
  
    
      
      	
      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/11/07/javascript-tip"><span class="circle_icon"></span>javascript 小技巧<span class='date'>07 Nov 2013</span></a></li>
      	
      
    
  
    
      
      	
      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/25/31CSS"><span class="circle_icon"></span>31 种 CSS 选择器用法<span class='date'>25 Oct 2013</span></a></li>
      	
      
    
  
    
      
      	
      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/05/Responsive_Web_Design_step"><span class="circle_icon"></span>复杂产品的响应式设计【流程篇】<span class='date'>05 Oct 2013</span></a></li>
      	
      
    
  
    
      
      	
      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/05/Responsive_Web_Design"><span class="circle_icon"></span>响应式网页设计<span class='date'>05 Oct 2013</span></a></li>
      	
      
    
  
    
      
      	
      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/03/qianduan"><span class="circle_icon"></span>前端的困局与突围(from 玉伯)<span class='date'>03 Oct 2013</span></a></li>
      	
      
    
  
    
      
      	
      	<li><a class="cate title3" href="/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/2013/10/03/markdown"><span class="circle_icon"></span>如何使用markdown<span class='date'>03 Oct 2013</span></a></li>
      	
      
    
  



					</ul>
					
				
					
					
				
					
					
				
					
					
				
		</div>
		<div id="container">
			<button class="navbar-toggle" type="button">
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
      		</button>
			<div id="pjax">
				<article id="post" class="title3">
					<header id="header">
						<h1 id="identifier">
								IE下iframe跨域session丢失问题和解决
						</h1>
					</header>
					<div id="content">
						<h1></h1>

<p>今天碰到一个问题，就是在IE下，使用iFrame嵌入页面时，该页面的会话级别的cookie无法写入，导致服务端始终无法获取JSESSIONID，每次都是产生一个新的，使得Session无法使用。</p>

<p>通过网上大量的搜索发现原来IE的iframe有特殊之处, 默认情况下, IE如果发现iframe的域和父页面的域不同, 则会禁止iframe页面写入Cookie(Session在默认情况下就是通过Cookie保存一个SessionID的)。 </p>

<p><img src="/blog-assets/2014-1-9/1.jpg" alt="网页设计"></p>

<p>如果将IE设置-&gt;隐私的级别调至最低, 也就是接受任何Cookie, 那么是运行正常的。</p>

<p><img src="/blog-assets/2014-1-9/2.jpg" alt="网页设计"></p>

<p>如果你按照上面操作并且你的问题解决了说明确定是IE这个特性导致的。
接下来我们将解决这问题。</p>

<p>问题怎么出现的呢也许你会好奇。</p>

<p>原因是<strong><em>P3P</em></strong></p>

<p>从本质上来说，P3P 策略是由一系列多选项问题的答案组成的，因此，它并不总像一个人类可读的隐私策略那样包含许多信息细节（例如，用英语或者其他某种口语语言写成的策略是用来让人阅读的,而不是让计算机识别的）。P3P策略的标准格式使它便于自动处理。同 样 ，P3P规范也包含有用于请求和传输P3P策略的协议.P3P协议所基于的HTTP协议与 Web 浏览器用来与 Web服务器进行通信的 HTTP 协议相同。如图 1-1 所示，P3P 的用户代理使用标准的 HTTP 请求从 Web 站点上一个众所周知的地方获取 P3P 策略引用文件，并发送给发出请求的用户。这个策略引用文件指出了Web站点上各个部分所应用的P3P策略文件的位置。整个站点有可能只应用了一种策略，也可能是网站的不同部分分别应用了几种策略。这样用户代理就可以根据用户的选择来获取合适的策略，将其解析出来并采取相应的动作</p>

<p>P3P 也允许站点在其他位置放置策略引用文件。在这些情况下，站点在声明策略引用文件的位置时，必须使用一个特定的 HTTP 报头，或者在应用了 P3P 策略的html 文件内嵌入一个 link 标 记 。
不论在何时设置cookie都可以用特定的HTTP报头来传送一个可选的 P3P 简洁策略.简洁策略是完整 P3P 策略的一个短小摘要，仅描述了与cooki e 相关的数据处理方式，并且不需要P3P 策略的完整的表达性能。</p>

<p><strong>如何使Web站点支持P3P:</strong></p>

<p>从技术角度看，使 Web站点支持 P3P 是一个很容易的过程。但是，它要求网络运营商在审视数据处理方式时比以前更加仔细，并要求他们协调域内各个主机上的策略和处理方式。以下是如何使站点支持P3P 技术的具体步骤。</p>

<ol>
<li>创建一个隐私策略。</li>
<li>分析 cookie 的使用情况以及您的站点上的第三方内容。</li>
<li>确定要对整个站点应用一个P3P策略还是对站点的不同部分应用不同的P3P 策略。</li>
<li>为站点创建一个或几个 P3P 策略。</li>
<li>为站点创建一个策略引用文件。</li>
<li>为 P3P 配置服务器。</li>
<li>测试站点，以确定它确实支持 P3P。</li>
</ol>

<p>大多数支持P3P的Web站点会在每台服务器上放置一个P3P策略引用文件，同时它还会在中央服务器上放置一个或多个P3P策略。这些站点也会将自己的服务器配置为用户在设置 cookie 时发送 P3P 的简洁策略。P3P 策略包括以下信息：</p>

<p>● 如何与拥有该站点的公司、组织或个人进行联系的信息。</p>

<p>● 用户是否可以查找该站点的数据库中保存了自己的哪些个人信息。</p>

<p>● 如何解决与站点之间有关隐私的纠纷（如客户服务台、隐私封印以及与隐私相关的法律等）。</p>

<p>● 所收集数据的种类。</p>

<p>● 所收集数据的使用方式，以及用户是否能选择接受或拒绝这些用途。</p>

<p>● 信息是否会被共享以及何时被共享，用户是否有选择的权力。</p>

<p>● 对所收集的用户信息进行定期清除的策略。</p>

<p><strong>HTTP Response Header :</strong></p>

<p>参考资源:<a href="http://www.w3.org/2002/04/P3Pv1-header.html">http://www.w3.org/2002/04/P3Pv1-header.html</a></p>

<p>Compact Policies(简洁策略)</p>

<p>简洁策略,本质上就是P3P策略的一个摘要. 他们的作用是,使用户代理,可以快速敏捷的获取到站点的P3P策略信息,所以是对性能有益的. </p>

<p>我们常用的简洁策略的 P3P头为 -   P3P : CP=CAO PSA OUR</p>

<p><strong>总结下浏览器支持情况：</strong></p>

<p><img src="/blog-assets/2014-1-9/3.png" alt="网页设计"></p>

<p>既然知道这么多了，我们来解决问题吧。
以PHP为例子
解决这些问题，归根结底只需要一条语句设置一下header，在PHP中，如下：</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="x">header(&#39;P3P: CP=&quot;CURa ADMa DEVa PSAo PSDo OUR BUS UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR&quot;&#39;);</span>
</code></pre></div>
<p><strong><em>PS:如果是使用session的话，这条语句请使用在session_start();之前，如果是使用cookie，请在setcookie之前设置header。</em></strong></p>

<p>当然，比较容易想到。另外的解决办法就是在URL中加入sessionid。对此就不举例了。</p>

					</div>
				</article>
			</div>
			<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread">
				
<div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare">
<a class="bds_tsina"></a>
<a class="bds_tqq"></a>
<a class="bds_renren"></a>
<a class="bds_hi"></a>
<span class="bds_more">更多</span>
</div>
<script type="text/javascript" id="bdshare_js" data="type=tools&amp;mini=1&amp;uid=6840238" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
</script>
	</div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"susiyang"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->

		</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="/assets/index.min.js?body=4.0.0"></script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ffbcbbadeaf00526725e0f222ba832804' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46315687-1', 'ssy.me');
  ga('send', 'pageview');

</script>
	</body>
</html>