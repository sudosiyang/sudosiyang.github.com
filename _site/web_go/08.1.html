<!DOCTYPE HTML>
<html lang="en-US" >

    <head>

        <meta charset="UTF-8">
        <title>Socket编程 | Go Web 编程</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">




    <link rel="next" href="./08.2.html" />


    <link rel="prev" href="./08.0.html" />



    </head>
    <body>


<link rel="stylesheet" href="gitbook/style.css">



    <div class="book"  data-level="8.1" data-basepath="." data-revision="1419313468079">


<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">










        <li class="chapter " data-level="0" data-path="index.html">


                    <a href="./index.html">
                        <i class="fa fa-check"></i>

                         简介
                    </a>



        </li>


        <li class="chapter " data-level="1" data-path="01.0.html">


                    <a href="./01.0.html">
                        <i class="fa fa-check"></i>

                            <b>1.</b>

                         Go环境配置
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="1.1" data-path="01.1.html">


                    <a href="./01.1.html">
                        <i class="fa fa-check"></i>

                            <b>1.1.</b>

                         Go安装
                    </a>



        </li>


        <li class="chapter " data-level="1.2" data-path="01.2.html">


                    <a href="./01.2.html">
                        <i class="fa fa-check"></i>

                            <b>1.2.</b>

                         GOPATH 与工作空间
                    </a>



        </li>


        <li class="chapter " data-level="1.3" data-path="01.3.html">


                    <a href="./01.3.html">
                        <i class="fa fa-check"></i>

                            <b>1.3.</b>

                         Go 命令
                    </a>



        </li>


        <li class="chapter " data-level="1.4" data-path="01.4.html">


                    <a href="./01.4.html">
                        <i class="fa fa-check"></i>

                            <b>1.4.</b>

                         Go开发工具
                    </a>



        </li>


        <li class="chapter " data-level="1.5" data-path="01.5.html">


                    <a href="./01.5.html">
                        <i class="fa fa-check"></i>

                            <b>1.5.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="2" data-path="02.0.html">


                    <a href="./02.0.html">
                        <i class="fa fa-check"></i>

                            <b>2.</b>

                         Go语言基础
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="2.1" data-path="02.1.html">


                    <a href="./02.1.html">
                        <i class="fa fa-check"></i>

                            <b>2.1.</b>

                         你好，Go
                    </a>



        </li>


        <li class="chapter " data-level="2.2" data-path="02.2.html">


                    <a href="./02.2.html">
                        <i class="fa fa-check"></i>

                            <b>2.2.</b>

                         Go基础
                    </a>



        </li>


        <li class="chapter " data-level="2.3" data-path="02.3.html">


                    <a href="./02.3.html">
                        <i class="fa fa-check"></i>

                            <b>2.3.</b>

                         流程和函数
                    </a>



        </li>


        <li class="chapter " data-level="2.4" data-path="02.4.html">


                    <a href="./02.4.html">
                        <i class="fa fa-check"></i>

                            <b>2.4.</b>

                         struct
                    </a>



        </li>


        <li class="chapter " data-level="2.5" data-path="02.5.html">


                    <a href="./02.5.html">
                        <i class="fa fa-check"></i>

                            <b>2.5.</b>

                         面向对象
                    </a>



        </li>


        <li class="chapter " data-level="2.6" data-path="02.6.html">


                    <a href="./02.6.html">
                        <i class="fa fa-check"></i>

                            <b>2.6.</b>

                         interface
                    </a>



        </li>


        <li class="chapter " data-level="2.7" data-path="02.7.html">


                    <a href="./02.7.html">
                        <i class="fa fa-check"></i>

                            <b>2.7.</b>

                         并发
                    </a>



        </li>


        <li class="chapter " data-level="2.8" data-path="02.8.html">


                    <a href="./02.8.html">
                        <i class="fa fa-check"></i>

                            <b>2.8.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="3" data-path="03.0.html">


                    <a href="./03.0.html">
                        <i class="fa fa-check"></i>

                            <b>3.</b>

                         Web基础
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="3.1" data-path="03.1.html">


                    <a href="./03.1.html">
                        <i class="fa fa-check"></i>

                            <b>3.1.</b>

                         web工作方式
                    </a>



        </li>


        <li class="chapter " data-level="3.2" data-path="03.2.html">


                    <a href="./03.2.html">
                        <i class="fa fa-check"></i>

                            <b>3.2.</b>

                         Go搭建一个简单的web服务
                    </a>



        </li>


        <li class="chapter " data-level="3.3" data-path="03.3.html">


                    <a href="./03.3.html">
                        <i class="fa fa-check"></i>

                            <b>3.3.</b>

                         Go如何使得web工作
                    </a>



        </li>


        <li class="chapter " data-level="3.4" data-path="03.4.html">


                    <a href="./03.4.html">
                        <i class="fa fa-check"></i>

                            <b>3.4.</b>

                         Go的http包详解
                    </a>



        </li>


        <li class="chapter " data-level="3.5" data-path="03.5.html">


                    <a href="./03.5.html">
                        <i class="fa fa-check"></i>

                            <b>3.5.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="4" data-path="04.0.html">


                    <a href="./04.0.html">
                        <i class="fa fa-check"></i>

                            <b>4.</b>

                         表单
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="4.1" data-path="04.1.html">


                    <a href="./04.1.html">
                        <i class="fa fa-check"></i>

                            <b>4.1.</b>

                         处理表单的输入
                    </a>



        </li>


        <li class="chapter " data-level="4.2" data-path="04.2.html">


                    <a href="./04.2.html">
                        <i class="fa fa-check"></i>

                            <b>4.2.</b>

                         验证表单的输入
                    </a>



        </li>


        <li class="chapter " data-level="4.3" data-path="04.3.html">


                    <a href="./04.3.html">
                        <i class="fa fa-check"></i>

                            <b>4.3.</b>

                         预防跨站脚本
                    </a>



        </li>


        <li class="chapter " data-level="4.4" data-path="04.4.html">


                    <a href="./04.4.html">
                        <i class="fa fa-check"></i>

                            <b>4.4.</b>

                         防止多次递交表单
                    </a>



        </li>


        <li class="chapter " data-level="4.5" data-path="04.5.html">


                    <a href="./04.5.html">
                        <i class="fa fa-check"></i>

                            <b>4.5.</b>

                         处理文件上传
                    </a>



        </li>


        <li class="chapter " data-level="4.6" data-path="04.6.html">


                    <a href="./04.6.html">
                        <i class="fa fa-check"></i>

                            <b>4.6.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="5" data-path="05.0.html">


                    <a href="./05.0.html">
                        <i class="fa fa-check"></i>

                            <b>5.</b>

                         访问数据库
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="5.1" data-path="05.1.html">


                    <a href="./05.1.html">
                        <i class="fa fa-check"></i>

                            <b>5.1.</b>

                         database/sql接口
                    </a>



        </li>


        <li class="chapter " data-level="5.2" data-path="05.2.html">


                    <a href="./05.2.html">
                        <i class="fa fa-check"></i>

                            <b>5.2.</b>

                         使用MySQL数据库
                    </a>



        </li>


        <li class="chapter " data-level="5.3" data-path="05.3.html">


                    <a href="./05.3.html">
                        <i class="fa fa-check"></i>

                            <b>5.3.</b>

                         使用SQLite数据库
                    </a>



        </li>


        <li class="chapter " data-level="5.4" data-path="05.4.html">


                    <a href="./05.4.html">
                        <i class="fa fa-check"></i>

                            <b>5.4.</b>

                         使用PostgreSQL数据库
                    </a>



        </li>


        <li class="chapter " data-level="5.5" data-path="05.5.html">


                    <a href="./05.5.html">
                        <i class="fa fa-check"></i>

                            <b>5.5.</b>

                         使用beedb库进行ORM开发
                    </a>



        </li>


        <li class="chapter " data-level="5.6" data-path="05.6.html">


                    <a href="./05.6.html">
                        <i class="fa fa-check"></i>

                            <b>5.6.</b>

                         NOSQL数据库操作
                    </a>



        </li>


        <li class="chapter " data-level="5.7" data-path="05.7.html">


                    <a href="./05.7.html">
                        <i class="fa fa-check"></i>

                            <b>5.7.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="6" data-path="06.0.html">


                    <a href="./06.0.html">
                        <i class="fa fa-check"></i>

                            <b>6.</b>

                         session和数据存储
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="6.1" data-path="06.1.html">


                    <a href="./06.1.html">
                        <i class="fa fa-check"></i>

                            <b>6.1.</b>

                         session和cookie
                    </a>



        </li>


        <li class="chapter " data-level="6.2" data-path="06.2.html">


                    <a href="./06.2.html">
                        <i class="fa fa-check"></i>

                            <b>6.2.</b>

                         Go如何使用session
                    </a>



        </li>


        <li class="chapter " data-level="6.3" data-path="06.3.html">


                    <a href="./06.3.html">
                        <i class="fa fa-check"></i>

                            <b>6.3.</b>

                         session存储
                    </a>



        </li>


        <li class="chapter " data-level="6.4" data-path="06.4.html">


                    <a href="./06.4.html">
                        <i class="fa fa-check"></i>

                            <b>6.4.</b>

                         预防session劫持
                    </a>



        </li>


        <li class="chapter " data-level="6.5" data-path="06.5.html">


                    <a href="./06.5.html">
                        <i class="fa fa-check"></i>

                            <b>6.5.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="7" data-path="07.0.html">


                    <a href="./07.0.html">
                        <i class="fa fa-check"></i>

                            <b>7.</b>

                         文本文件处理
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="7.1" data-path="07.1.html">


                    <a href="./07.1.html">
                        <i class="fa fa-check"></i>

                            <b>7.1.</b>

                         XML处理
                    </a>



        </li>


        <li class="chapter " data-level="7.2" data-path="07.2.html">


                    <a href="./07.2.html">
                        <i class="fa fa-check"></i>

                            <b>7.2.</b>

                         JSON处理
                    </a>



        </li>


        <li class="chapter " data-level="7.3" data-path="07.3.html">


                    <a href="./07.3.html">
                        <i class="fa fa-check"></i>

                            <b>7.3.</b>

                         正则处理
                    </a>



        </li>


        <li class="chapter " data-level="7.4" data-path="07.4.html">


                    <a href="./07.4.html">
                        <i class="fa fa-check"></i>

                            <b>7.4.</b>

                         模板处理
                    </a>



        </li>


        <li class="chapter " data-level="7.5" data-path="07.5.html">


                    <a href="./07.5.html">
                        <i class="fa fa-check"></i>

                            <b>7.5.</b>

                         文件操作
                    </a>



        </li>


        <li class="chapter " data-level="7.6" data-path="07.6.html">


                    <a href="./07.6.html">
                        <i class="fa fa-check"></i>

                            <b>7.6.</b>

                         字符串处理
                    </a>



        </li>


        <li class="chapter " data-level="7.7" data-path="07.7.html">


                    <a href="./07.7.html">
                        <i class="fa fa-check"></i>

                            <b>7.7.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="8" data-path="08.0.html">


                    <a href="./08.0.html">
                        <i class="fa fa-check"></i>

                            <b>8.</b>

                         Web服务
                    </a>



            <ul class="articles">



        <li class="chapter active" data-level="8.1" data-path="08.1.html">


                    <a href="./08.1.html">
                        <i class="fa fa-check"></i>

                            <b>8.1.</b>

                         Socket编程
                    </a>



        </li>


        <li class="chapter " data-level="8.2" data-path="08.2.html">


                    <a href="./08.2.html">
                        <i class="fa fa-check"></i>

                            <b>8.2.</b>

                         WebSocket
                    </a>



        </li>


        <li class="chapter " data-level="8.3" data-path="08.3.html">


                    <a href="./08.3.html">
                        <i class="fa fa-check"></i>

                            <b>8.3.</b>

                         REST
                    </a>



        </li>


        <li class="chapter " data-level="8.4" data-path="08.4.html">


                    <a href="./08.4.html">
                        <i class="fa fa-check"></i>

                            <b>8.4.</b>

                         RPC
                    </a>



        </li>


        <li class="chapter " data-level="8.5" data-path="08.5.html">


                    <a href="./08.5.html">
                        <i class="fa fa-check"></i>

                            <b>8.5.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="9" data-path="09.0.html">


                    <a href="./09.0.html">
                        <i class="fa fa-check"></i>

                            <b>9.</b>

                         安全与加密
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="9.1" data-path="09.1.html">


                    <a href="./09.1.html">
                        <i class="fa fa-check"></i>

                            <b>9.1.</b>

                         预防CSRF攻击
                    </a>



        </li>


        <li class="chapter " data-level="9.2" data-path="09.2.html">


                    <a href="./09.2.html">
                        <i class="fa fa-check"></i>

                            <b>9.2.</b>

                         确保输入过滤
                    </a>



        </li>


        <li class="chapter " data-level="9.3" data-path="09.3.html">


                    <a href="./09.3.html">
                        <i class="fa fa-check"></i>

                            <b>9.3.</b>

                         避免XSS攻击
                    </a>



        </li>


        <li class="chapter " data-level="9.4" data-path="09.4.html">


                    <a href="./09.4.html">
                        <i class="fa fa-check"></i>

                            <b>9.4.</b>

                         避免SQL注入
                    </a>



        </li>


        <li class="chapter " data-level="9.5" data-path="09.5.html">


                    <a href="./09.5.html">
                        <i class="fa fa-check"></i>

                            <b>9.5.</b>

                         存储密码
                    </a>



        </li>


        <li class="chapter " data-level="9.6" data-path="09.6.html">


                    <a href="./09.6.html">
                        <i class="fa fa-check"></i>

                            <b>9.6.</b>

                         加密和解密数据
                    </a>



        </li>


        <li class="chapter " data-level="9.7" data-path="09.7.html">


                    <a href="./09.7.html">
                        <i class="fa fa-check"></i>

                            <b>9.7.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="10" data-path="10.0.html">


                    <a href="./10.0.html">
                        <i class="fa fa-check"></i>

                            <b>10.</b>

                         国际化和本地化
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="10.1" data-path="10.1.html">


                    <a href="./10.1.html">
                        <i class="fa fa-check"></i>

                            <b>10.1.</b>

                         设置默认地区
                    </a>



        </li>


        <li class="chapter " data-level="10.2" data-path="10.2.html">


                    <a href="./10.2.html">
                        <i class="fa fa-check"></i>

                            <b>10.2.</b>

                         本地化资源
                    </a>



        </li>


        <li class="chapter " data-level="10.3" data-path="10.3.html">


                    <a href="./10.3.html">
                        <i class="fa fa-check"></i>

                            <b>10.3.</b>

                         国际化站点
                    </a>



        </li>


        <li class="chapter " data-level="10.4" data-path="10.4.html">


                    <a href="./10.4.html">
                        <i class="fa fa-check"></i>

                            <b>10.4.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="11" data-path="11.0.html">


                    <a href="./11.0.html">
                        <i class="fa fa-check"></i>

                            <b>11.</b>

                         错误处理，调试和测试
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="11.1" data-path="11.1.html">


                    <a href="./11.1.html">
                        <i class="fa fa-check"></i>

                            <b>11.1.</b>

                         错误处理
                    </a>



        </li>


        <li class="chapter " data-level="11.2" data-path="11.2.html">


                    <a href="./11.2.html">
                        <i class="fa fa-check"></i>

                            <b>11.2.</b>

                         使用GDB调试
                    </a>



        </li>


        <li class="chapter " data-level="11.3" data-path="11.3.html">


                    <a href="./11.3.html">
                        <i class="fa fa-check"></i>

                            <b>11.3.</b>

                         Go怎么写测试用例
                    </a>



        </li>


        <li class="chapter " data-level="11.4" data-path="11.4.html">


                    <a href="./11.4.html">
                        <i class="fa fa-check"></i>

                            <b>11.4.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="12" data-path="12.0.html">


                    <a href="./12.0.html">
                        <i class="fa fa-check"></i>

                            <b>12.</b>

                         部署与维护
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="12.1" data-path="12.1.html">


                    <a href="./12.1.html">
                        <i class="fa fa-check"></i>

                            <b>12.1.</b>

                         应用日志
                    </a>



        </li>


        <li class="chapter " data-level="12.2" data-path="12.2.html">


                    <a href="./12.2.html">
                        <i class="fa fa-check"></i>

                            <b>12.2.</b>

                         网站错误处理
                    </a>



        </li>


        <li class="chapter " data-level="12.3" data-path="12.3.html">


                    <a href="./12.3.html">
                        <i class="fa fa-check"></i>

                            <b>12.3.</b>

                         应用部署
                    </a>



        </li>


        <li class="chapter " data-level="12.4" data-path="12.4.html">


                    <a href="./12.4.html">
                        <i class="fa fa-check"></i>

                            <b>12.4.</b>

                         备份和恢复
                    </a>



        </li>


        <li class="chapter " data-level="12.5" data-path="12.5.html">


                    <a href="./12.5.html">
                        <i class="fa fa-check"></i>

                            <b>12.5.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="13" data-path="13.0.html">


                    <a href="./13.0.html">
                        <i class="fa fa-check"></i>

                            <b>13.</b>

                         如何设计一个Web框架
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="13.1" data-path="13.1.html">


                    <a href="./13.1.html">
                        <i class="fa fa-check"></i>

                            <b>13.1.</b>

                         项目规划
                    </a>



        </li>


        <li class="chapter " data-level="13.2" data-path="13.2.html">


                    <a href="./13.2.html">
                        <i class="fa fa-check"></i>

                            <b>13.2.</b>

                         自定义路由器设计
                    </a>



        </li>


        <li class="chapter " data-level="13.3" data-path="13.3.html">


                    <a href="./13.3.html">
                        <i class="fa fa-check"></i>

                            <b>13.3.</b>

                         controller设计
                    </a>



        </li>


        <li class="chapter " data-level="13.4" data-path="13.4.html">


                    <a href="./13.4.html">
                        <i class="fa fa-check"></i>

                            <b>13.4.</b>

                         日志和配置设计
                    </a>



        </li>


        <li class="chapter " data-level="13.5" data-path="13.5.html">


                    <a href="./13.5.html">
                        <i class="fa fa-check"></i>

                            <b>13.5.</b>

                         实现博客的增删改
                    </a>



        </li>


        <li class="chapter " data-level="13.6" data-path="13.6.html">


                    <a href="./13.6.html">
                        <i class="fa fa-check"></i>

                            <b>13.6.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="14" data-path="14.0.html">


                    <a href="./14.0.html">
                        <i class="fa fa-check"></i>

                            <b>14.</b>

                         扩展Web框架
                    </a>



            <ul class="articles">



        <li class="chapter " data-level="14.1" data-path="14.1.html">


                    <a href="./14.1.html">
                        <i class="fa fa-check"></i>

                            <b>14.1.</b>

                         静态文件支持
                    </a>



        </li>


        <li class="chapter " data-level="14.2" data-path="14.2.html">


                    <a href="./14.2.html">
                        <i class="fa fa-check"></i>

                            <b>14.2.</b>

                         Session支持
                    </a>



        </li>


        <li class="chapter " data-level="14.3" data-path="14.3.html">


                    <a href="./14.3.html">
                        <i class="fa fa-check"></i>

                            <b>14.3.</b>

                         表单支持
                    </a>



        </li>


        <li class="chapter " data-level="14.4" data-path="14.4.html">


                    <a href="./14.4.html">
                        <i class="fa fa-check"></i>

                            <b>14.4.</b>

                         用户认证
                    </a>



        </li>


        <li class="chapter " data-level="14.5" data-path="14.5.html">


                    <a href="./14.5.html">
                        <i class="fa fa-check"></i>

                            <b>14.5.</b>

                         多语言支持
                    </a>



        </li>


        <li class="chapter " data-level="14.6" data-path="14.6.html">


                    <a href="./14.6.html">
                        <i class="fa fa-check"></i>

                            <b>14.6.</b>

                         pprof支持
                    </a>



        </li>


        <li class="chapter " data-level="14.7" data-path="14.7.html">


                    <a href="./14.7.html">
                        <i class="fa fa-check"></i>

                            <b>14.7.</b>

                         小结
                    </a>



        </li>


            </ul>

        </li>


        <li class="chapter " data-level="15" data-path="ref.html">


                    <a href="./ref.html">
                        <i class="fa fa-check"></i>

                            <b>15.</b>

                         参考资料
                    </a>



        </li>




        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>

    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>

    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->

    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>



    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>


    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>


    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>



    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Go Web 编程</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">


                    <section class="normal" id="section-gitbook_56">

                        <h1 id="81-socket">8.1 Socket编程</h1>
<p>在很多底层网络应用开发者的眼里一切编程都是Socket，话虽然有点夸张，但却也几乎如此了，现在的网络编程几乎都是用Socket来编程。你想过这些情景么？我们每天打开浏览器浏览网页时，浏览器进程怎么和Web服务器进行通信的呢？当你用QQ聊天时，QQ进程怎么和服务器或者是你的好友所在的QQ进程进行通信的呢？当你打开PPstream观看视频时，PPstream进程如何与视频服务器进行通信的呢？ 如此种种，都是靠Socket来进行通信的，以一斑窥全豹，可见Socket编程在现代编程中占据了多么重要的地位，这一节我们将介绍Go语言中如何进行Socket编程。</p>
<h2 id="socket">什么是Socket？</h2>
<p>Socket起源于Unix，而Unix基本哲学之一就是“一切皆文件”，都可以用“打开open –&gt; 读写write/read –&gt; 关闭close”模式来操作。Socket就是该模式的一个实现，网络的Socket数据传输是一种特殊的I/O，Socket也是一种文件描述符。Socket也具有一个类似于打开文件的函数调用：Socket()，该函数返回一个整型的Socket描述符，随后的连接建立、数据传输等操作都是通过该Socket实现的。</p>
<p>常用的Socket类型有两种：流式Socket（SOCK_STREAM）和数据报式Socket（SOCK_DGRAM）。流式是一种面向连接的Socket，针对于面向连接的TCP服务应用；数据报式Socket是一种无连接的Socket，对应于无连接的UDP服务应用。</p>
<h2 id="socket">Socket如何通信</h2>
<p>网络中的进程之间如何通过Socket通信呢？首要解决的问题是如何唯一标识一个进程，否则通信无从谈起！在本地可以通过进程PID来唯一标识一个进程，但是在网络中这是行不通的。其实TCP/IP协议族已经帮我们解决了这个问题，网络层的“ip地址”可以唯一标识网络中的主机，而传输层的“协议+端口”可以唯一标识主机中的应用程序（进程）。这样利用三元组（ip地址，协议，端口）就可以标识网络的进程了，网络中需要互相通信的进程，就可以利用这个标志在他们之间进行交互。请看下面这个TCP/IP协议结构图</p>
<p><img src="images/8.1.socket.png?raw=true" alt=""></p>
<p>图8.1 七层网络协议图</p>
<p>使用TCP/IP协议的应用程序通常采用应用编程接口：UNIX BSD的套接字（socket）和UNIX System V的TLI（已经被淘汰），来实现网络进程之间的通信。就目前而言，几乎所有的应用程序都是采用socket，而现在又是网络时代，网络中进程通信是无处不在，这就是为什么说“一切皆Socket”。</p>
<h2 id="socket">Socket基础知识</h2>
<p>通过上面的介绍我们知道Socket有两种：TCP Socket和UDP Socket，TCP和UDP是协议，而要确定一个进程的需要三元组，需要IP地址和端口。</p>
<h3 id="ipv4">IPv4地址</h3>
<p>目前的全球因特网所采用的协议族是TCP/IP协议。IP是TCP/IP协议中网络层的协议，是TCP/IP协议族的核心协议。目前主要采用的IP协议的版本号是4(简称为IPv4)，发展至今已经使用了30多年。</p>
<p>IPv4的地址位数为32位，也就是最多有2的32次方的网络设备可以联到Internet上。近十年来由于互联网的蓬勃发展，IP位址的需求量愈来愈大，使得IP位址的发放愈趋紧张，前一段时间，据报道IPV4的地址已经发放完毕，我们公司目前很多服务器的IP都是一个宝贵的资源。</p>
<p>地址格式类似这样：127.0.0.1 172.122.121.111</p>
<h3 id="ipv6">IPv6地址</h3>
<p>IPv6是下一版本的互联网协议，也可以说是下一代互联网的协议，它是为了解决IPv4在实施过程中遇到的各种问题而被提出的，IPv6采用128位地址长度，几乎可以不受限制地提供地址。按保守方法估算IPv6实际可分配的地址，整个地球的每平方米面积上仍可分配1000多个地址。在IPv6的设计过程中除了一劳永逸地解决了地址短缺问题以外，还考虑了在IPv4中解决不好的其它问题，主要有端到端IP连接、服务质量（QoS）、安全性、多播、移动性、即插即用等。</p>
<p>地址格式类似这样：2002:c0e8:82e7:0:0:0:c0e8:82e7</p>
<h3 id="goip">Go支持的IP类型</h3>
<p>在Go的<code>net</code>包中定义了很多类型、函数和方法用来网络编程，其中IP的定义如下：</p>
<pre><code>type IP []byte
</code></pre><p>在<code>net</code>包中有很多函数来操作IP，但是其中比较有用的也就几个，其中<code>ParseIP(s string) IP</code>函数会把一个IPv4或者IPv6的地址转化成IP类型，请看下面的例子:</p>
<pre><code>package main
import (
    &quot;net&quot;
    &quot;os&quot;
    &quot;fmt&quot;
)
func main() {
    if len(os.Args) != 2 {
        fmt.Fprintf(os.Stderr, &quot;Usage: %s ip-addr\n&quot;, os.Args[0])
        os.Exit(1)
    }
    name := os.Args[1]
    addr := net.ParseIP(name)
    if addr == nil {
        fmt.Println(&quot;Invalid address&quot;)
    } else {
        fmt.Println(&quot;The address is &quot;, addr.String())
    }
    os.Exit(0)
}
</code></pre><p>执行之后你就会发现只要你输入一个IP地址就会给出相应的IP格式</p>
<h2 id="tcp-socket">TCP Socket</h2>
<p>当我们知道如何通过网络端口访问一个服务时，那么我们能够做什么呢？作为客户端来说，我们可以通过向远端某台机器的的某个网络端口发送一个请求，然后得到在机器的此端口上监听的服务反馈的信息。作为服务端，我们需要把服务绑定到某个指定端口，并且在此端口上监听，当有客户端来访问时能够读取信息并且写入反馈信息。</p>
<p>在Go语言的<code>net</code>包中有一个类型<code>TCPConn</code>，这个类型可以用来作为客户端和服务器端交互的通道，他有两个主要的函数：</p>
<pre><code>func (c *TCPConn) Write(b []byte) (n int, err os.Error)
func (c *TCPConn) Read(b []byte) (n int, err os.Error)
</code></pre><p><code>TCPConn</code>可以用在客户端和服务器端来读写数据。</p>
<p>还有我们需要知道一个<code>TCPAddr</code>类型，他表示一个TCP的地址信息，他的定义如下：</p>
<pre><code>type TCPAddr struct {
    IP IP
    Port int
}
</code></pre><p>在Go语言中通过<code>ResolveTCPAddr</code>获取一个<code>TCPAddr</code></p>
<pre><code>func ResolveTCPAddr(net, addr string) (*TCPAddr, os.Error)
</code></pre><ul>
<li>net参数是&quot;tcp4&quot;、&quot;tcp6&quot;、&quot;tcp&quot;中的任意一个，分别表示TCP(IPv4-only),TCP(IPv6-only)或者TCP(IPv4,IPv6的任意一个).</li>
<li>addr表示域名或者IP地址，例如&quot;www.google.com:80&quot; 或者&quot;127.0.0.1:22&quot;.</li>
</ul>
<h3 id="tcp-client">TCP client</h3>
<p>Go语言中通过net包中的<code>DialTCP</code>函数来建立一个TCP连接，并返回一个<code>TCPConn</code>类型的对象，当连接建立时服务器端也创建一个同类型的对象，此时客户端和服务器段通过各自拥有的<code>TCPConn</code>对象来进行数据交换。一般而言，客户端通过<code>TCPConn</code>对象将请求信息发送到服务器端，读取服务器端响应的信息。服务器端读取并解析来自客户端的请求，并返回应答信息，这个连接只有当任一端关闭了连接之后才失效，不然这连接可以一直在使用。建立连接的函数定义如下：</p>
<pre><code>func DialTCP(net string, laddr, raddr *TCPAddr) (c *TCPConn, err os.Error)
</code></pre><ul>
<li>net参数是&quot;tcp4&quot;、&quot;tcp6&quot;、&quot;tcp&quot;中的任意一个，分别表示TCP(IPv4-only)、TCP(IPv6-only)或者TCP(IPv4,IPv6的任意一个)</li>
<li>laddr表示本机地址，一般设置为nil</li>
<li>raddr表示远程的服务地址</li>
</ul>
<p>接下来我们写一个简单的例子，模拟一个基于HTTP协议的客户端请求去连接一个Web服务端。我们要写一个简单的http请求头，格式类似如下：</p>
<pre><code>&quot;HEAD / HTTP/1.0\r\n\r\n&quot;
</code></pre><p>从服务端接收到的响应信息格式可能如下：</p>
<pre><code>HTTP/1.0 200 OK
ETag: &quot;-9985996&quot;
Last-Modified: Thu, 25 Mar 2010 17:51:10 GMT
Content-Length: 18074
Connection: close
Date: Sat, 28 Aug 2010 00:43:48 GMT
Server: lighttpd/1.4.23
</code></pre><p>我们的客户端代码如下所示：</p>
<pre><code>package main

import (
    &quot;fmt&quot;
    &quot;io/ioutil&quot;
    &quot;net&quot;
    &quot;os&quot;
)

func main() {
    if len(os.Args) != 2 {
        fmt.Fprintf(os.Stderr, &quot;Usage: %s host:port &quot;, os.Args[0])
        os.Exit(1)
    }
    service := os.Args[1]
    tcpAddr, err := net.ResolveTCPAddr(&quot;tcp4&quot;, service)
    checkError(err)
    conn, err := net.DialTCP(&quot;tcp&quot;, nil, tcpAddr)
    checkError(err)
    _, err = conn.Write([]byte(&quot;HEAD / HTTP/1.0\r\n\r\n&quot;))
    checkError(err)
    result, err := ioutil.ReadAll(conn)
    checkError(err)
    fmt.Println(string(result))
    os.Exit(0)
}
func checkError(err error) {
    if err != nil {
        fmt.Fprintf(os.Stderr, &quot;Fatal error: %s&quot;, err.Error())
        os.Exit(1)
    }
}
</code></pre><p>通过上面的代码我们可以看出：首先程序将用户的输入作为参数<code>service</code>传入<code>net.ResolveTCPAddr</code>获取一个tcpAddr,然后把tcpAddr传入DialTCP后创建了一个TCP连接<code>conn</code>，通过<code>conn</code>来发送请求信息，最后通过<code>ioutil.ReadAll</code>从<code>conn</code>中读取全部的文本，也就是服务端响应反馈的信息。</p>
<h3 id="tcp-server">TCP server</h3>
<p>上面我们编写了一个TCP的客户端程序，也可以通过net包来创建一个服务器端程序，在服务器端我们需要绑定服务到指定的非激活端口，并监听此端口，当有客户端请求到达的时候可以接收到来自客户端连接的请求。net包中有相应功能的函数，函数定义如下：</p>
<pre><code>func ListenTCP(net string, laddr *TCPAddr) (l *TCPListener, err os.Error)
func (l *TCPListener) Accept() (c Conn, err os.Error)
</code></pre><p>参数说明同DialTCP的参数一样。下面我们实现一个简单的时间同步服务，监听7777端口</p>
<pre><code>package main

import (
    &quot;fmt&quot;
    &quot;net&quot;
    &quot;os&quot;
    &quot;time&quot;
)

func main() {
    service := &quot;:7777&quot;
    tcpAddr, err := net.ResolveTCPAddr(&quot;tcp4&quot;, service)
    checkError(err)
    listener, err := net.ListenTCP(&quot;tcp&quot;, tcpAddr)
    checkError(err)
    for {
        conn, err := listener.Accept()
        if err != nil {
            continue
        }
        daytime := time.Now().String()
        conn.Write([]byte(daytime)) // don&#39;t care about return value
        conn.Close()                // we&#39;re finished with this client
    }
}
func checkError(err error) {
    if err != nil {
        fmt.Fprintf(os.Stderr, &quot;Fatal error: %s&quot;, err.Error())
        os.Exit(1)
    }
}
</code></pre><p>上面的服务跑起来之后，它将会一直在那里等待，直到有新的客户端请求到达。当有新的客户端请求到达并同意接受<code>Accept</code>该请求的时候他会反馈当前的时间信息。值得注意的是，在代码中<code>for</code>循环里，当有错误发生时，直接continue而不是退出，是因为在服务器端跑代码的时候，当有错误发生的情况下最好是由服务端记录错误，然后当前连接的客户端直接报错而退出，从而不会影响到当前服务端运行的整个服务。</p>
<p>上面的代码有个缺点，执行的时候是单任务的，不能同时接收多个请求，那么该如何改造以使它支持多并发呢？Go里面有一个goroutine机制，请看下面改造后的代码</p>
<pre><code>package main

import (
    &quot;fmt&quot;
    &quot;net&quot;
    &quot;os&quot;
    &quot;time&quot;
)

func main() {
    service := &quot;:1200&quot;
    tcpAddr, err := net.ResolveTCPAddr(&quot;tcp4&quot;, service)
    checkError(err)
    listener, err := net.ListenTCP(&quot;tcp&quot;, tcpAddr)
    checkError(err)
    for {
        conn, err := listener.Accept()
        if err != nil {
            continue
        }
        go handleClient(conn)
    }
}

func handleClient(conn net.Conn) {
    defer conn.Close()
    daytime := time.Now().String()
    conn.Write([]byte(daytime)) // don&#39;t care about return value
    // we&#39;re finished with this client
}
func checkError(err error) {
    if err != nil {
        fmt.Fprintf(os.Stderr, &quot;Fatal error: %s&quot;, err.Error())
        os.Exit(1)
    }
}
</code></pre><p>通过把业务处理分离到函数<code>handleClient</code>，我们就可以进一步地实现多并发执行了。看上去是不是很帅，增加<code>go</code>关键词就实现了服务端的多并发，从这个小例子也可以看出goroutine的强大之处。</p>
<p>有的朋友可能要问：这个服务端没有处理客户端实际请求的内容。如果我们需要通过从客户端发送不同的请求来获取不同的时间格式，而且需要一个长连接，该怎么做呢？请看：</p>
<pre><code>package main

import (
    &quot;fmt&quot;
    &quot;net&quot;
    &quot;os&quot;
    &quot;time&quot;
    &quot;strconv&quot;
)

func main() {
    service := &quot;:1200&quot;
    tcpAddr, err := net.ResolveTCPAddr(&quot;tcp4&quot;, service)
    checkError(err)
    listener, err := net.ListenTCP(&quot;tcp&quot;, tcpAddr)
    checkError(err)
    for {
        conn, err := listener.Accept()
        if err != nil {
            continue
        }
        go handleClient(conn)
    }
}

func handleClient(conn net.Conn) {
    conn.SetReadDeadline(time.Now().Add(2 * time.Minute)) // set 2 minutes timeout
    request := make([]byte, 128) // set maxium request length to 128KB to prevent flood attack
    defer conn.Close()  // close connection before exit
    for {
        read_len, err := conn.Read(request)

        if err != nil {
            fmt.Println(err)
            break
        }

        if read_len == 0 {
            break // connection already closed by client
        } else if string(request) == &quot;timestamp&quot; {
            daytime := strconv.FormatInt(time.Now().Unix(), 10)
            conn.Write([]byte(daytime))
        } else {
            daytime := time.Now().String()
            conn.Write([]byte(daytime))
        }

        request = make([]byte, 128) // clear last read content
    }
}

func checkError(err error) {
    if err != nil {
        fmt.Fprintf(os.Stderr, &quot;Fatal error: %s&quot;, err.Error())
        os.Exit(1)
    }
}
</code></pre><p>在上面这个例子中，我们使用<code>conn.Read()</code>不断读取客户端发来的请求。由于我们需要保持与客户端的长连接，所以不能在读取完一次请求后就关闭连接。由于<code>conn.SetReadDeadline()</code>设置了超时，当一定时间内客户端无请求发送，<code>conn</code>便会自动关闭，下面的for循环即会因为连接已关闭而跳出。需要注意的是，<code>request</code>在创建时需要指定一个最大长度以防止flood attack；每次读取到请求处理完毕后，需要清理request，因为<code>conn.Read()</code>会将新读取到的内容append到原内容之后。</p>
<h3 id="tcp">控制TCP连接</h3>
<p>TCP有很多连接控制函数，我们平常用到比较多的有如下几个函数：</p>
<pre><code>func DialTimeout(net, addr string, timeout time.Duration) (Conn, error)
</code></pre><p>设置建立连接的超时时间，客户端和服务器端都适用，当超过设置时间时，连接自动关闭。</p>
<pre><code>func (c *TCPConn) SetReadDeadline(t time.Time) error
func (c *TCPConn) SetWriteDeadline(t time.Time) error
</code></pre><p>用来设置写入/读取一个连接的超时时间。当超过设置时间时，连接自动关闭。</p>
<pre><code>func (c *TCPConn) SetKeepAlive(keepalive bool) os.Error
</code></pre><p>设置客户端是否和服务器端保持长连接，可以降低建立TCP连接时的握手开销，对于一些需要频繁交换数据的应用场景比较适用。</p>
<p>更多的内容请查看<code>net</code>包的文档。</p>
<h2 id="udp-socket">UDP Socket</h2>
<p>Go语言包中处理UDP Socket和TCP Socket不同的地方就是在服务器端处理多个客户端请求数据包的方式不同,UDP缺少了对客户端连接请求的Accept函数。其他基本几乎一模一样，只有TCP换成了UDP而已。UDP的几个主要函数如下所示：</p>
<pre><code>func ResolveUDPAddr(net, addr string) (*UDPAddr, os.Error)
func DialUDP(net string, laddr, raddr *UDPAddr) (c *UDPConn, err os.Error)
func ListenUDP(net string, laddr *UDPAddr) (c *UDPConn, err os.Error)
func (c *UDPConn) ReadFromUDP(b []byte) (n int, addr *UDPAddr, err os.Error
func (c *UDPConn) WriteToUDP(b []byte, addr *UDPAddr) (n int, err os.Error)
</code></pre><p>一个UDP的客户端代码如下所示,我们可以看到不同的就是TCP换成了UDP而已：</p>
<pre><code>package main

import (
    &quot;fmt&quot;
    &quot;net&quot;
    &quot;os&quot;
)

func main() {
    if len(os.Args) != 2 {
        fmt.Fprintf(os.Stderr, &quot;Usage: %s host:port&quot;, os.Args[0])
        os.Exit(1)
    }
    service := os.Args[1]
    udpAddr, err := net.ResolveUDPAddr(&quot;udp4&quot;, service)
    checkError(err)
    conn, err := net.DialUDP(&quot;udp&quot;, nil, udpAddr)
    checkError(err)
    _, err = conn.Write([]byte(&quot;anything&quot;))
    checkError(err)
    var buf [512]byte
    n, err := conn.Read(buf[0:])
    checkError(err)
    fmt.Println(string(buf[0:n]))
    os.Exit(0)
}
func checkError(err error) {
    if err != nil {
        fmt.Fprintf(os.Stderr, &quot;Fatal error &quot;, err.Error())
        os.Exit(1)
    }
}
</code></pre><p>我们来看一下UDP服务器端如何来处理：</p>
<pre><code>package main

import (
    &quot;fmt&quot;
    &quot;net&quot;
    &quot;os&quot;
    &quot;time&quot;
)

func main() {
    service := &quot;:1200&quot;
    udpAddr, err := net.ResolveUDPAddr(&quot;udp4&quot;, service)
    checkError(err)
    conn, err := net.ListenUDP(&quot;udp&quot;, udpAddr)
    checkError(err)
    for {
        handleClient(conn)
    }
}
func handleClient(conn *net.UDPConn) {
    var buf [512]byte
    _, addr, err := conn.ReadFromUDP(buf[0:])
    if err != nil {
        return
    }
    daytime := time.Now().String()
    conn.WriteToUDP([]byte(daytime), addr)
}
func checkError(err error) {
    if err != nil {
        fmt.Fprintf(os.Stderr, &quot;Fatal error &quot;, err.Error())
        os.Exit(1)
    }
}
</code></pre><h2 id="">总结</h2>
<p>通过对TCP和UDP Socket编程的描述和实现，可见Go已经完备地支持了Socket编程，而且使用起来相当的方便，Go提供了很多函数，通过这些函数可以很容易就编写出高性能的Socket应用。</p>
<h2 id="links">links</h2>
<ul>
<li><a href="preface.html">目录</a></li>
<li>上一节: <a href="08.0.html">Web服务</a></li>
<li>下一节: <a href="08.2.html">WebSocket</a></li>
</ul>


                    </section>


                </div>
            </div>
        </div>


        <a href="./08.0.html" class="navigation navigation-prev " aria-label="Previous page: Web服务"><i class="fa fa-angle-left"></i></a>


        <a href="./08.2.html" class="navigation navigation-next " aria-label="Next page: WebSocket"><i class="fa fa-angle-right"></i></a>

    </div>
</div>


<script src="gitbook/app.js"></script>


    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>


<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>


    </body>

</html>
